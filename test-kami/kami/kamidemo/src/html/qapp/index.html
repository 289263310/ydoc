<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>QApp Demo</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name="format-detection" content="telephone=no,email=no" />
    <style type="text/css">
qapp-app {
    position: absolute;
    overflow: hidden;
}

qapp-view {
    display: block;
    float: left;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: white;
}

// 用于 moveEnter 的手势操作
qapp-view .touch-opacity {
    top: 0.44rem; // 根据实际情况设置 0.44rem 为 header 高度，避免返回按钮点击不上。
    bottom: 0;
}
    </style>

    <link rel="stylesheet" href="../../../prd/yo/usage/kami/pagelist.css" />
    <link rel="stylesheet" href="../../../prd/yo/usage/kami/alert.css" />
    <link rel="stylesheet" href="../../../prd/yo/usage/export/yo-flex.css" />
</head>
<body>

<script type="text/javascript" src="../../../prd/scripts/common.js"></script>
<script type="text/javascript" src="../../../prd/scripts/qapp/index.js"></script>
<script type="template/javascript" id="tplIndex">
<div class="yo-flex">
    <header class="yo-header m-header">
        <h2 class="title">QApp中使用kami</h2>
        <a href="../../../index.html" class="regret yo-ico">&#xf07d;</a>
        <span class="affirm yo-ico">&#xf067;</span>
    </header>
    <div class="flex">
        <div class="yo-list yo-list-group">
            <h2 class="label">Panel:</h2>
            <div class="item item-active" action-type="panel">
                <i class="yo-ico">&#xf078;</i>
                <span class="flex">通过实例打开Panel</span>
                <i class="yo-ico">&#xf03e;</i>
            </div>
            <div class="item item-active" action-type="panel-attr">
                <i class="yo-ico">&#xf078;</i>
                <span class="flex">通过属性打开Panel</span>
                <i class="yo-ico">&#xf03e;</i>
            </div>

            <h2 class="label">PageList:</h2>
            <div class="item item-active" action-type="pagelist">
                <i class="yo-ico">&#xf078;</i>
                <span class="flex">常用pagelist样式</span>
                <i class="yo-ico">&#xf03e;</i>
            </div>
            <div class="item item-active" action-type="pagelist-compose">
                <i class="yo-ico">&#xf078;</i>
                <span class="flex">pagelist组合用法</span>
                <i class="yo-ico">&#xf03e;</i>
            </div>

            <h2 class="label">单例调用:</h2>
            <div class="item item-active" action-type="alert-singleton">
                <i class="yo-ico">&#xf078;</i>
                <span class="flex">Alert</span>
                <i class="yo-ico">&#xf03e;</i>
            </div>

            <h2 class="label">非单例调用:</h2>
            <div class="item item-active" action-type="alert">
                <i class="yo-ico">&#xf078;</i>
                <span class="flex">Alert</span>
                <i class="yo-ico">&#xf03e;</i>
            </div>
        </div>
    </div>
</div>
</script>
<script type="template/javascript" id="tplPanel">


<div class="yo-flex">
    <header class="yo-header m-header">
        <h2 class="yo-header m-header">Panel</h2>
        <span class="regret yo-ico" action-type="close">&#xf07d;</span>
    </header>
    <!-- 组件容器 必须 -->
    <div class="flex" id="container" style='overflow:hidden;'>
        <!-- 滚动容器 必须 -->
        <div data-role="scroller">
        <!-- 内容更新容器 必须 -->
        <div data-role="body">

            <div class="yo-list yo-list-group">
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
            </div>

        </div></div>
    </div>

</div>
</script>
<script type="template/javascript" id="tplPanleAttr">


<div class="yo-flex">
    <header class="yo-header m-header">
        <h2 class="yo-header m-header">Panel节点</h2>
        <span class="regret yo-ico" action-type="close">&#xf07d;</span>
    </header>
    <!-- 组件容器 必须 -->
    <div class="flex" id="container" style='overflow:hidden;'
         qapp-widget="panel"
         data-panel-id="panel">
        <!-- 滚动容器 必须 -->
        <div data-role="scroller">
        <!-- 内容更新容器 必须 -->
        <div data-role="body">

            <div class="yo-list yo-list-group">
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
                <div class="item item-active" action-type="panel">
                    <i class="yo-ico">&#xf078;</i>
                    <span class="flex">1</span>
                    <i class="yo-ico">&#xf03e;</i>
                </div>
            </div>

        </div></div>
    </div>

</div>
</script>
<script type="template/javascript" id="tplPageList">


<div class="yo-flex">
    <header class="yo-header m-header">
        <h2 class="yo-header m-header">PageList</h2>
        <span class="regret yo-ico" action-type="close">&#xf07d;</span>
    </header>
    <!-- 组件容器 必须 -->
    <div class="flex" id="container" style='overflow:hidden;'>
    </div>

</div>
</script>
<script type="template/javascript" id="tplSlider">
<li class="item yo-slidermenu" data-role="list-item" data-index="{{dataIndex}}">
    <div class="front" data-role="slideMenuCnt">
        向左滑动{{text}}
    </div>
    <div class="action" data-role="slideMenuAction"><div action="detail">查看详情</div><div action="del">删除</div></div>
</li>
</script>
<script type="text/javascript">

var KamiPanel = Kami.Panel;
var KamiPageList = Kami.PageList;
var KamiAlert = Kami.Alert;
var KamiSliderMenu = Kami.SliderMenu;

QApp.util.KamiAdapterFactory.register('panel', KamiPanel);
QApp.util.KamiAdapterFactory.register('pagelist', KamiPageList);
QApp.util.KamiAdapterFactory.register('alert', KamiAlert);
// 非单例alert，注册名不能为alert
QApp.util.KamiAdapterFactory.register('Alert', KamiAlert);
QApp.util.KamiAdapterFactory.register('slidermenu', KamiSliderMenu);

// 首页view
QApp.defineView('index', {
    html: $("#tplIndex").html(),
    plugins: ['delegated'], 
    bindActions: {
        'panel': function(){
            QApp.show('panel')
        },
        'panel-attr': function(){
            QApp.show('panelAttr')
        },
        'pagelist': function(){
            QApp.show('pagelist')
        },
        'pagelist-compose': function(){
            QApp.show('pagelist-compose')
        },
        'alert-singleton': function(){
            // 单例alert
            var alert = QApp.showWidget('alert');
            var options = {
                title: '单例',
                content: 'test'
            };
            alert.show(options);
        },
        'alert': function(){
            // 非单例alert，widget名字不能为alert
            var alert = QApp.showWidget('Alert', {
                title: '非单例',
                content: 'test'
            })
            alert.show()
        }
    },
    ready: function() {
        console.log('ready')
    }
});

// panel view
QApp.defineView('panel', {
    html: $('#tplPanel').html(),
    plugins: ['delegated'], 
    bindEvents: {
        show: function() {
            var panel = QApp.showWidget('panel', {
                container: "#container"
            })
            panel.render()
        }
    },
    bindActions: {
        'close': function(){
            this.hide()
        }
    },
    ready: function(){
        
    }
});

// panel attr view
QApp.defineView('panelAttr', {
    html: $("#tplPanleAttr").html(),
    plugins: ['delegated'], 
    bindEvents: {
        show: function() {
            this.widgets.panel.on('tap', function(){
                console.log('tap')
            })
        }
    },
    bindActions: {
        'close': function(){
            this.hide()
        }
    },
    ready: function(){
    }
});
// 默认版本，只支持text属性
var datasource = function(){
    var arr = [];
    for(var i= 1, j = 20; i<=j;i++){
        arr.push({
            text: i,
            value: i + 'v'
        })
    }
    return arr;
}();

// 生成数据数据
function getRandomData () {
    return datasource.sort(function(){
        return Math.random() - 0.5;
    })
}

// pagelist view
QApp.defineView('pagelist', {
    html: $("#tplPageList").html(),
    plugins: ['delegated'],
    init: {

    },
    bindEvents: {
        show: function() {
            var pagelist = QApp.showWidget('pagelist', {
                container: "#container",
                datasource: datasource,
                pagesize: 20,
                // 加载更多的时候开启，可以提升性能
                infinite: true,
                // 开启上拉加载更多
                useLoadmore: true,
                useRefresh: true

            });
            pagelist.on('loadmore', function(){
                var self = this;
                var data = getRandomData();
                // 模拟ajax
                setTimeout(function(){
                    // 刷新数据，并且关闭刷新提示
                    // 使用loadMore方法添加数据
                    self.loadMore( [] );
                }, 500)
            });

            pagelist.on('refresh', function(){
                var data = getRandomData();
                // 刷新数据，并且关闭刷新提示
                // 使用refresh刷新数据
                this.refresh( data );
            });

            pagelist.on('tap', function(e){
                var target = $(e.currentTarget);
                console.log("tap index:" + target.data('index'))
            });
            // pagelist.render();  切记切记，不能再render了
        }
    },
    bindActions: {
        'close': function(){
            this.hide()
        }
    },
    ready: function(){
        
    }
});

// pagelist view
QApp.defineView('pagelist-compose', {
    html: $("#tplPageList").html(),
    plugins: ['delegated'],
    init: {

    },
    bindEvents: {
        show: function() {
            var itemTpl = $('#tplSlider').html();
            var pagelist = QApp.showWidget('pagelist', {
                container: "#container",
                datasource: datasource,
                // 锁定Y
                canLockY: true,
                itemTpl: itemTpl,
                pagesize: 20,
                // 加载更多的时候开启，可以提升性能
                infinite: true,
                // 开启上拉加载更多
                useLoadmore: true,
                useRefresh: true,
                onready: function(){
                    // pagelist render后触发
                    // 正常情况下使用，在ready回调里使用
                    
                }

            });
            var sm = QApp.showWidget('slidermenu', {
                container: '[data-role=itemwrap]',
                direction: -1,
                width: 100
            });
            sm.on('tap', function(item){
                console.log(item.innerHTML);
            })
            sm.render();

            pagelist.on('loadmore', function(){
                var self = this;
                var data = getRandomData();
                // 模拟ajax
                setTimeout(function(){
                    // 刷新数据，并且关闭刷新提示
                    // 使用loadMore方法添加数据
                    self.loadMore( data );

                    var sm = QApp.showWidget('slidermenu', {
                    container: '[data-role=itemwrap]',
                    direction: -1,
                    width: 100
                });
                sm.on('tap', function(item){
                    console.log(item.innerHTML);
                })
                sm.render();
                }, 500)
            });

            pagelist.on('refresh', function(){
                var data = getRandomData();
                // 刷新数据，并且关闭刷新提示
                // 使用refresh刷新数据
                this.refresh( data );
            });

            pagelist.on('tap', function(e){
                var target = $(e.currentTarget);
                console.log("tap index:" + target.data('index'))
            });
            // pagelist.render();  切记切记，不能再render了
        }
    },
    bindActions: {
        'close': function(){
            this.hide()
        }
    },
    ready: function(){
        
    }
});

</script>
</body>
</html>