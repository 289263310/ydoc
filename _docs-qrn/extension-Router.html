<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
  <meta name="description" content="description of your site">
  <meta name="author" content="author of the site">
  <title>Qunar React Native EXT</title>
  <link rel="stylesheet" href="source/app.css"/>
  <link rel="stylesheet" href="source/highlight.min.css"/>
</head>
<body>
    <div class="ydoc">

      <header class="ydoc-header">
        <div class="ydoc-header-area">
            
            <button class="ydocIcon navbar-toggle">&#xf020;</button>
            <nav class="ydoc-nav">
              <ul class="navbar-left">
                
                    
                    <li class="">
                        
                        <a href="index.html">开始</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="component.html">组件</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="extraUI.html">外部组件</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="api.html">API</a>
                        
                    </li>
                    
                    <li class="active">
                        
                        <a href="extension.html">EXT</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="extending.html">扩展</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="demo.html">DEMO</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="faq.html">FAQ</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="releases.html">Releases</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="http://ued.qunar.com/react-web/" target="_blank">React Web</a>
                        
                    </li>
                    
                
              </ul>
            </nav>
        </div>
    </header>
    
    <!-- <header style="height:20px"></header> -->
    
      <!-- Docs page layout -->
      
      <div class="ydoc-banner-bg">
          <div class="ydoc-banner">
              <div class="ydoc-banner-area">
                  <h1>Qunar React Native Extension</h1>
                  <p>Qunar React Native 增强拓展框架</p>
              </div>
          </div>
      




      <div class="ydoc-container">
        
          
          <div class="ydoc-container-content">
              <div class="content-right">
                  <nav class="sidebar">
                    <ul class="nav docs-sidenav">
                        
                        
                        <li  class="active" >
                            
                            <a href="extension-Router.html">Router</a>
                            
                        </li>
                        
                        
                        
                        
                        <ul class="docs-sidenav-extend" >
                        
                            <li >
                                <a href="#介绍">介绍</a>
                            </li>
                        
                        
                        
                        
                        
                            <li >
                                <a href="#开始">开始</a>
                            </li>
                        
                        
                        
                        
                        
                            <li >
                                <a href="#文档">文档</a>
                            </li>
                        
                        
                        
                        
                        
                            <li >
                                <a href="#实战">实战</a>
                            </li>
                        
                        </ul>
                        
                        
                        
                        
                        <li >
                            
                            <a href="extension-WebX.html">WebX</a>
                            
                        </li>
                        
                        
                        
                        <li >
                            
                            <a href="extension-Redux.html">Redux</a>
                            
                        </li>
                        
                        
                        
                        <li >
                            
                            <a href="extension-Fetch.html">Fetch</a>
                            
                        </li>
                        
                        
                    </ul>
                  </nav>
              </div>
              <div class="content-left markdown-body">
                
                <h1 id="Router - Ext Plugin">Router - Ext Plugin</h1><h2 id="介绍">介绍</h2><p><strong>Router</strong> 作为 <strong>Ext</strong> 的内置插件，为其提供更加强大好用的路由功能。</p>
<p><strong>Router</strong> 具有如下特点：</p>
<ol>
<li><p>封装原生的 <code>Navigator</code> 组件，提供更加友好的接口。</p>
</li>
<li><p>和 <code>view</code> 耦合，无需手动配置路由映射关系。</p>
</li>
<li><p>强大、自由的导航栏配置。</p>
</li>
<li><p>传参、动画等拓展功能。</p>
</li>
<li><p>简洁直观的生命周期。</p>
</li>
<li><p>可以在含有 native 页面的混合应用中灵活地跳转。</p>
</li>
</ol>
<h2 id="开始">开始</h2><p>引用与配置：</p>
<pre><code class="lang-js">
// 配置业务 hybridId，在多业务跳转时会用到
Ext.defaults.hybridId = &#39;hotel&#39;;
// 配置应用名（可以不配置，默认为 &#39;Naive&#39;）
Ext.defaults.appName = &#39;extDemo&#39;;
// 配置首页（可以不配置，默认为 require 的第一个页面）
Ext.defaults.indexView = &#39;base&#39;;

// 引入页面
import &#39;./views/base&#39;
import &#39;./views/pageA&#39;
import &#39;./views/pageB&#39;
</code></pre>
<p>注意：</p>
<ul>
<li>Router 会自动根据配置去调 <code>AppRegistry.registerComponent()</code> 方法。</li>
</ul>
<p>使用 <strong>Router</strong>：</p>
<pre><code class="lang-js">class base extends QView {
    styles = styles;
    render = render;

    // Actions
    // Router 方法调用
    open() {
        Ext.open(&#39;pageA&#39;, {
            // 传递参数
            param: {
                api: &#39;open&#39;,
                from: &#39;base&#39;,
                to: &#39;pageA&#39;
            },
            // 配置动画
            sceneConfigs: &#39;VerticalUpSwipeJump&#39;
        });
    };
    goto() {
        Ext.goto(&#39;pageB&#39;, {
            param: {
                api: &#39;goto&#39;,
                from: &#39;base&#39;,
                to: &#39;pageB&#39;
            }
        });
    };
    back() {
        Ext.back({
            param: {
                api: &#39;back&#39;,
                from: &#39;pageA&#39;,
                to: &#39;base&#39;
            }
        });
    };
    home() {
        Ext.home({
            param: {
                api: &#39;home&#39;,
                from: &#39;base&#39;,
                to: &#39;base&#39;
            }
        });
    };
    close() {
        Ext.close();
    };

    // Events
    // Router 生命周期回调注册
    bindEvents = {
        ready() {
            console.log(&#39;[base][ready]&#39;, this.props);
        },
        actived(param) {
            console.log(&#39;[base][actived]&#39;, param);
        },
        deactived() {
            console.log(&#39;[base][deactived]&#39;);
        },
        destroy() {
            console.log(&#39;[base][destroy]&#39;);
        }
    };
});
</code></pre>
<h2 id="文档">文档</h2><h3 id="API">API</h3><h4 id="<code>open(name[, opts])</code>"><code>open(name[, opts])</code></h4><p>打开一个新的页面（新建历史）。</p>
<ul>
<li><p><code>name</code> String 目标页面的名字</p>
</li>
<li><p><code>opts</code> Object 配置项</p>
<ul>
<li><p><code>opts.param</code> Object 需要传递的参数</p>
</li>
<li><p><code>opts.sceneConfigs</code> Object|String 场景配置项或预设动画名（参考：<a href="https://facebook.github.io/react-native/docs/navigator.html">Navigator – React Native | A framework for building native apps using React</a>）   </p>
</li>
</ul>
</li>
</ul>
<h4 id="<code>back([opts])</code>"><code>back([opts])</code></h4><p>回到上一个页面。</p>
<ul>
<li><p><code>opts</code> Object 配置项</p>
<ul>
<li><code>opts.param</code> Object 需要传递的参数</li>
</ul>
</li>
</ul>
<h4 id="<code>backTo(name[, opts])</code>"><code>backTo(name[, opts])</code></h4><p>回到指定页面。</p>
<ul>
<li><p><code>name</code> String 目标页面的名字</p>
</li>
<li><p><code>opts</code> Object 配置项</p>
<ul>
<li><code>opts.param</code> Object 需要传递的参数</li>
</ul>
</li>
</ul>
<h4 id="<code>goto(name[, opts])</code>"><code>goto(name[, opts])</code></h4><p>前往指定页面（历史中有则回退，没有则新建历史）。</p>
<ul>
<li><p><code>name</code> String 目标页面的名字</p>
</li>
<li><p><code>opts</code> Object 配置项</p>
<ul>
<li><p><code>opts.param</code> Object 需要传递的参数</p>
</li>
<li><p><code>opts.sceneConfigs</code> Object|String 场景配置项或预设动画名（如果是返回动作，此配置项无效）</p>
</li>
</ul>
</li>
</ul>
<h4 id="<code>home([opts])</code>"><code>home([opts])</code></h4><p>回到首页。</p>
<ul>
<li><p><code>opts</code> Object 配置项</p>
<ul>
<li><code>opts.param</code> Object 需要传递的参数</li>
</ul>
</li>
</ul>
<h4 id="<code>close(name)</code>"><code>close(name)</code></h4><p>关闭指定页面。默认关闭当前页，返回上一页。</p>
<ul>
<li><code>name</code> String 目标页面的名字</li>
</ul>
<h3 id="生命周期">生命周期</h3><p><img src="http://ww3.sinaimg.cn/large/4c8b519dgw1f281rs22ryj213m0s4794.jpg" alt=""></p>
<h4 id="可注册的回调函数">可注册的回调函数</h4><p>以下所有注册回调函数内部 <code>this</code> 均为当前页面。</p>
<h5 id="<code>ready()</code>"><code>ready()</code></h5><p>页面准备完成时。通过 <code>this.porps.param</code> 可以获取 <code>open(name, opts)</code> 时传入的参数。</p>
<blockquote>
<p>举例：从 A 页面打开 B 页面，此时 B 页面就准备完成了。</p>
</blockquote>
<h5 id="<code>actived(param)</code>"><code>actived(param)</code></h5><p>页面激活时。<code>param</code> 为来源页携带的参数。</p>
<blockquote>
<p>举例：B 页面是从 A 页面打开的，现在从 B 页面返回 A 页面，此时 A 页面就被激活了。</p>
</blockquote>
<h5 id="<code>deactived()</code>"><code>deactived()</code></h5><p>页面失活时。</p>
<blockquote>
<p>举例：从 A 页面打开 B 页面，此时 A 页面就失活了。</p>
</blockquote>
<h5 id="<code>destroy()</code>"><code>destroy()</code></h5><p>页面销毁时。</p>
<blockquote>
<p>举例：B 页面是从 A 页面打开的，现在从 B 页面返回 A 页面，此时 B 页面就被销毁了。</p>
</blockquote>
<h4 id="和原生周期的关系">和原生周期的关系</h4><table>
<thead>
<tr>
<th style="text-align:center">Router 生命周期</th>
<th style="text-align:center">原生生命周期</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>ready</code></td>
<td style="text-align:center"><code>componentDidMount</code></td>
</tr>
<tr>
<td style="text-align:center"><code>actived</code></td>
<td style="text-align:center">无</td>
</tr>
<tr>
<td style="text-align:center"><code>deactived</code></td>
<td style="text-align:center">无</td>
</tr>
<tr>
<td style="text-align:center"><code>destroy</code></td>
<td style="text-align:center"><code>componentWillUnmount</code></td>
</tr>
</tbody>
</table>
<h3 id="API 和生命周期的关系">API 和生命周期的关系</h3><table>
<thead>
<tr>
<th style="text-align:center">API</th>
<th style="text-align:center">触发的生命周期回调</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>open</code></td>
<td style="text-align:center">当前页面的 <code>deactive</code> 和下一页面的 <code>ready</code>、<code>actived</code></td>
</tr>
<tr>
<td style="text-align:center"><code>goto</code></td>
<td style="text-align:center">若新建历史：当前页面的 <code>deactive</code> 和下一页面的 <code>ready</code>、<code>actived</code>；若回到历史：当前页面的 <code>deactive</code>、<code>destroy</code> 和下一页面的 <code>actived</code></td>
</tr>
<tr>
<td style="text-align:center"><code>back</code></td>
<td style="text-align:center">当前页面的 <code>deactive</code>、<code>destroy</code> 和下一页面的 <code>actived</code></td>
</tr>
<tr>
<td style="text-align:center"><code>backTo</code></td>
<td style="text-align:center">当前页面的 <code>deactive</code>、<code>destroy</code> 和下一页面的 <code>actived</code></td>
</tr>
<tr>
<td style="text-align:center"><code>home</code></td>
<td style="text-align:center">当前页面的 <code>deactive</code>、<code>destroy</code> 和下一页面的 <code>actived</code></td>
</tr>
<tr>
<td style="text-align:center"><code>close</code></td>
<td style="text-align:center">若关闭当前页面：当前页面的 <code>deactive</code>、<code>destroy</code> 和下一页面的 <code>actived</code></td>
</tr>
</tbody>
</table>
<h3 id="导航栏">导航栏</h3><p>Router 默认提供了接近 iOS 原生样式的导航栏（类似 NavigatorIOS）。可以通过配置 <code>Ext.defaults.navBar.isShow = true</code> 来使用。</p>
<h4 id="全局配置">全局配置</h4><pre><code class="lang-js">// 配置全局导航栏
Ext.defaults.navBar = {
    // 是否显示，默认为 false，不显示
    isShow: true,
    // 背景色，默认 Qunar 蓝
    backgroundColor: &#39;red&#39;,
    // 导航栏文字颜色，默认白色
    color: &#39;black&#39;,
    // 导航栏高度,默认44(不包括状态栏高度)
    height: 80,
    //左右按钮宽度,默认60
    buttonWidth:60,
    //状态栏背景色,默认透明
    statusBarBackgroundColor:&#39;transparent&#39;,
    // 导航栏按钮点击不透明度，默认 0.6
    activeOpacity: 0.8,
    // 左侧按钮文字,默认&#39;返回&#39;
    leftButtonText: &#39;&lt;back&#39;
};
</code></pre>
<h4 id="页面级配置">页面级配置</h4><p>页面的routerPlugin可以覆盖全局配置的任意一项,并且新增了标题,导航栏左右按键的相关配置。</p>
<pre><code class="lang-js">class base extends QView {
    // 配置页面导航栏
    static routerPlugin = {
        // 是否显示导航栏
        isShow: true,
        // 背景色，默认 Qunar 蓝
        backgroundColor: &#39;red&#39;,
        // 文本颜色，默认白色
        color: &#39;black&#39;,
        // 按钮宽度
        buttonWidth:60,
        // 状态栏背景色
        statusBarBackgroundColor:&#39;red&#39;,
        // 导航栏高度
        height:80,
        //activeOpacity
        activeOpacity:0.6
        // 标题，默认route.name
        // 支持传入多种参数:
        // 字符串;
        // 返回JSX的函数,接受route和store作为参数:
        // (route,store)=&gt;(&lt;TouchableOpacity onPress={()=&gt;alert(&#39;custom jsx&#39;)}&gt;
        //    &lt;Text&gt;{route.name}&lt;/Text&gt;
        // &lt;/TouchableOpacity&gt;)
        // JSX
        title: &#39;Base&#39;,
        // 左侧按钮，默认为字符串&#39;返回&#39;
        // 同样支持传入字符串/函数/JSX
        leftButtonText: &lt;Text&gt;返回&lt;/Text&gt;,
        // 左侧按钮点击事件，默认 `Ext.back()`
        // 接受两个参数route和store
        leftButtonPressEvent(route,store) {
            alert(&#39;left...&#39;)
        },
        // 右侧按钮文字，默认空字符串
        // 同样支持传入字符串/函数/JSX
        rightButtonText(route,store){
          return (
            &lt;Text&gt;{route.name}&lt;/Text&gt;
          );
        },
        // 右侧按钮点击事件，默认空函数
        rightButtonPressEvent(route,store) {
            alert(&#39;right...&#39;);
        },
    };
}
</code></pre>
<h4 id="API">API</h4><h5 id="<code>setTitle(title)</code>"><code>setTitle(title)</code></h5><p>设置当前页面导航栏的标题。</p>
<ul>
<li><code>title</code> String/Function/JSX 使用方式与配置里面的title完全一致</li>
</ul>
<p>举例：</p>
<pre><code>//传入字符串
Ext.Router.setTitle(&#39;new Title&#39;);
//传入JSX
Ext.Router.setTitle(
  &lt;Text&gt;new Title&lt;/Text&gt;
);
//传入返回JSX的函数
Ext.Router.setTitle((route,store)=&gt;(
  &lt;Text&gt;{route.name}&lt;/Text&gt;
));
</code></pre><h5 id="<code>open(viewName, {title})</code>"><code>open(viewName, {title})</code></h5><p>打开新页面并设置新页面的标题。</p>
<ul>
<li><code>title</code> String 标题</li>
</ul>
<p>举例：</p>
<pre><code>Ext.open(&#39;pageA&#39;, {
    title: &#39;new Title&#39;,
});
</code></pre><h3 id="桥">桥</h3><p>Router 封装了 QRN 提供的 Native 桥，Router 自身处理了大部分桥，用户用到只会有以下几种：</p>
<h4 id="广播">广播</h4><h5 id="发送广播">发送广播</h5><pre><code class="lang-js">Ext.Router.Bridge.sendBroadcast({
    // 广播名
    name: &#39;getSomeMsg&#39;,
    // 广播内容
    data: {
        msg: &#39;i tell u a msg&#39;
    },
    // 指定发送目标，不指定则发给全局
    hybridId: &#39;hotel&#39;,
});
</code></pre>
<h5 id="接收广播">接收广播</h5><pre><code class="lang-js">DeviceEventEmitter.addListener(&#39;getSomeMsg&#39;, (data) =&gt; {
    // 以上面发送广播的 data 为例，接收到的 data 会长这样：
    data = {
        msg: &#39;i tell u a msg&#39;
    };
});
</code></pre>
<h4 id="发送 scheme">发送 scheme</h4><pre><code class="lang-js">Ext.Router.Bridge.sendScheme({
    // 地址
    url: &#39;&#39;,
    // 安卓透明层标识（只有安卓才有）
    adrToken: &#39;&#39;,
    // 数据
    data: {},
}, (res) =&gt; {
    // 发送后的回调
    res = {
        // 是否成功
        ret: true,
        // 数据
        data: {},
    };
});
</code></pre>
<h3 id="挂载在 <code>Ext</code> 上的对象">挂载在 <code>Ext</code> 上的对象</h3><p><strong>Router</strong> 会通过 <code>Ext.Router</code> 暴露出来。除了所有的 API 外，还暴露了内部的历史容器 <code>Ext.Router._vcs</code> 和页面容器 <code>Ext.Router._views</code>。</p>
<h2 id="实战">实战</h2><h3 id="Native 页面跳转">Native 页面跳转</h3><p>Router 极大便利了 RN 页面和 Native 页面（包括 HY 页面）的互跳操作。</p>
<p>在阅读下面内容前强烈建议先了解下与 RN 相关环境下的 Scheme：<a href="http://gitlab.corp.qunar.com/yayu.wang/wiki/blob/master/react-native-api-in-js-context.md#scheme">传送门</a>。</p>
<h4 id="Native -&gt; RN">Native -&gt; RN</h4><p>Native 打开 RN 页面一般有两种方式：</p>
<h5 id="1. 原生方法">1. 原生方法</h5><p>通过 native 代码打开，例如 iOS 通过 <code>QRCTVCCreater</code> 方法，详情参考 <a href="http://ued.qunar.com/qrn/doc/index-Native%E9%9B%86%E6%88%90%EF%BC%88iOS%EF%BC%89.html">iOS</a>、<a href="http://ued.qunar.com/qrn/doc/index-Native%E9%9B%86%E6%88%90%20%EF%BC%88Android%EF%BC%89.html">Android</a>。</p>
<p>如果首页需要获取从 Native 传入的参数，需要通过 <code>initialProperties.param</code> 携带。</p>
<h5 id="2. 发送 Scheme">2. 发送 Scheme</h5><p>通过发送 Scheme 也能跳转到 RN 页面，以 iOS 为例：</p>
<pre><code>@interface JumpHandle : NSObject
/**
 *  通过URL和urlData来调用界面
 *
 *  @param url          跳转到的URL，通常为 qunariphone://hotel/xxx 的形式
 *  @param urldata      处理URL所需使用的数据
 *  @param responseDelg 回调对象
 *  @param userInfo     自定义对象
 *
 *  @return 返回是否有模块接受该URL并进行处理，处理URL可能是异步的，不能保证线程安全
 */
+ (BOOL)jumpHandleOpenURL:(NSURL *)url
              withUrlData:(NSDictionary *)urldata
             responseDelg:(id&lt;JumpHandleResponsePrt&gt;)responseDelg
                 userInfo:(id)userInfo;
@end
</code></pre><h4 id="RN -&gt; Native">RN -&gt; Native</h4><p>一般通过发 Scheme 方式，举例：</p>
<pre><code class="lang-js">Ext.Router.Bridge.sendScheme({
    url: &#39;qunariphone://react/debug&#39;,
});
</code></pre>
<p>以上可以打开一个 native 页面。</p>
<h4 id="HY -&gt; RN">HY -&gt; RN</h4><p>通过 <code>a</code> 标签进行跳转，举例：</p>
<pre><code class="lang-html">&lt;p&gt;
    &lt;a href=&quot;qunariphone://react/open?hybridId=qunar_react_native_ext&amp;qInitView=pageA&quot;&gt;open：强制新开&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;
    &lt;a href=&quot;qunariphone://react/biz?hybridId=qunar_react_native_ext&amp;qInitView=pageA&amp;forceOpen=true&amp;initProps=%7B%22param%22%3A%7B%22name%22%3A%22wyy%22%7D%7D&quot;&gt;biz：强制新开&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;
    &lt;a href=&quot;qunariphone://react/biz?hybridId=qunar_react_native_ext&amp;qInitView=base&amp;initProps=%7B%22param%22%3A%7B%22name%22%3A%22wyy%22%7D%7D&quot;&gt;biz：返回 base&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;
    &lt;a href=&quot;qunariphone://react/biz?hybridId=qunar_react_native_ext&amp;qInitView=pageA&amp;initProps=%7B%22param%22%3A%7B%22name%22%3A%22wyy%22%7D%7D&quot;&gt;biz：返回 pageA&lt;/a&gt;
&lt;/p&gt;
</code></pre>
<p>具体可以参考 <a href="http://gitlab.corp.qunar.com/yayu.wang/qreact-test-hy/tree/master">QRN 配套测试 HY Demo</a></p>
<h4 id="RN -&gt; HY">RN -&gt; HY</h4><p>通过调用 <code>Ext.Router.Bridge.sendScheme</code> 方法，举例：</p>
<pre><code class="lang-js">let url = &#39;qunariphone://web/url?url=http%3A%2F%2Fwyy.qunar.com%2Fqreact-test-hy%2Findex.html&amp;loadview=auto&#39;;
Ext.Router.Bridge.sendScheme({
    url,
});
</code></pre>
<h3 id="阻止安卓物理返回">阻止安卓物理返回</h3><p>组件支持 <code>onBackPressed</code> 方法，方法返回 <code>true</code> 表示关闭安卓物理返回的响应，<code>false</code> 表示恢复安卓物理返回的响应。</p>
<pre><code class="lang-js">class SceneAndroidBack extends QView {

    constructor(props) {
        super(props);
        this.preventBackByAndroidKey = false;
    }

    onBackPressed() {
        return this.preventBackByAndroidKey;
    }

    setPreventBack(value) {
        this.preventBackByAndroidKey = value;
    }

    render() {
        return (
            &lt;View&gt;
                &lt;Text
                    onPress={this.setPreventBack.bind(this, true)}&gt;
                    阻止安卓物理返回
                &lt;/Text&gt;
                &lt;Text
                    onPress={this.setPreventBack.bind(this, false)}&gt;
                    恢复安卓物理返回
                &lt;/Text&gt;
            &lt;/View&gt;
        );
    }

}
</code></pre>

              </div>
          </div>
          
        
      </div>
     
     </div>
     
      <footer class="footer">
        <div class="copyright">
            © 2015 - 2016 Qunar 平台前端架构组. Powered by <a href="http://gitlab.corp.qunar.com/mfe/qdoc">qdoc</a>
        </div>
      </footer>
    </div>
    <script src="source/jquery.min.js"></script>
    <script src="source/highlight.min.js"></script>
    <script src="source/app.js"></script>
</body>
</html>
